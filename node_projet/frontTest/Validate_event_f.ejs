<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/css/Formulaires.css">
    <title> Validate an event Idea</title>
</head>
<body>
    <br>
    <br>
    
    <div class="row">
        <div class="col-1" style="width: 40%; height: 50%;">
            <h2>Validate an event Idea</h2><br>
            <form id="validateForm" method="post">
                <div class="mb-3">
                    <label for="p_EventID">Event ID:</label>
                     <input type="number" id="p_EventID" name="p_EventID" required>
                </div>    
                <br>
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
            <script>
                $(document).ready(function(){
                    $('#validateForm').submit(function(event){
                        event.preventDefault();
                        let formData = $(this).serializeArray();
                        let jsonData = {};
                        formData.forEach(function(field){
                            jsonData[field.name] = field.value;
                        });

                        let xhr = new XMLHttpRequest();
                        xhr.open("POST", "http://localhost:3000/cesi-bde/ev/validate", true);
                        xhr.setRequestHeader("Content-Type", "application/json");
                        xhr.onload = function(){
                            if(xhr.status === 200){
                                console.log(xhr.responseText);
                                let response = JSON.parse(xhr.responseText);

                                if(response.token){
                                    localStorage.setItem('token', response.token);
                                    console.log("ok");
                                }
                                window.location.href = "/cesi-bde/ev/events"; // Redirection vers une page après une réponse réussie
                            }else{
                                console.error("Erreur lors de l'envoi des données", xhr.statusText);
                                alert("Erreur lors de la connexion");
                            }
                        };
                        xhr.onerror = function(){
                            console.error("Erreur lors de l'envoi des données.");
                            alert("Erreur lors de l'inscription");
                        };

                        xhr.send(JSON.stringify(jsonData));
                    });
                });
            </script>
        </div>
    </div>

    <br>
    <br>
    <?php require_once "footer.html"; ?>

    <script src="script.js"></script>
</body>
</html>